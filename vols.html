<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Vols à venir - Zenith Airlines</title>
  <link rel="stylesheet" href="styles.css">
  <script>
    let volsData = [];

    document.addEventListener('DOMContentLoaded', function () {
      const offersContainer = document.querySelector('.offers');
      offersContainer.innerHTML = '<p>Chargement des vols...</p>';

      fetch('get_vols.php')
        .then(response => {
          if (!response.ok) throw new Error('Erreur lors de la récupération des données.');
          return response.json();
        })
        .then(data => {
          volsData = data;
          offersContainer.innerHTML = '';

          if (data.length > 0) {
            data.forEach(vol => {
              const volDiv = document.createElement('div');
              volDiv.classList.add('offer');
              volDiv.innerHTML = `
                <div class="offer-details">
                  <h3>${vol.origine} - ${vol.destination}</h3>
                  <p>Départ : ${new Date(vol.date_depart).toLocaleString()}</p>
                  <p>Arrivée : ${new Date(vol.date_arrivee).toLocaleString()}</p>
                  <p>Durée : ${vol.duree}</p>
                  <p>Prix : ${vol.prix} €</p>
                  <div class="buttons">
                    <button class="add-to-cart" data-id="${vol.id_vol}">Ajouter au panier</button>
                    <button class="details-button" data-id="${vol.id_vol}">Détails</button>
                  </div>
                </div>
              `;
              offersContainer.appendChild(volDiv);
            });

            attachAddToCartEvents();
            attachDetailsEvents();
          } else {
            offersContainer.innerHTML = '<p>Aucun vol disponible pour le moment.</p>';
          }
        })
        .catch(error => {
          console.error('Erreur :', error);
          offersContainer.innerHTML = '<p>Erreur lors du chargement des vols. Veuillez réessayer plus tard.</p>';
        });
    });

    function attachAddToCartEvents() {
      document.querySelectorAll('.add-to-cart').forEach(button => {
        button.addEventListener('click', function () {
          const volId = this.dataset.id;
          fetch('add_to_cart.php', {
            method: 'POST',
            headers: { 'Content-Type': 'application/x-www-form-urlencoded' },
            body: `id_vol=${volId}`
          })
            .then(response => response.json())
            .then(data => {
              alert(data.success ? 'Vol ajouté au panier avec succès !' : (data.error || 'Erreur inconnue.'));
            })
            .catch(error => {
              console.error('Erreur réseau :', error);
              alert('Impossible d\'ajouter au panier.');
            });
        });
      });
    }

    function attachDetailsEvents() {
      const detailButtons = document.querySelectorAll('.details-button');
      const modal = document.getElementById('modal');
      const closeBtn = modal.querySelector('.close');

      detailButtons.forEach(button => {
        button.addEventListener('click', function () {
          const volId = this.dataset.id;
          const vol = volsData.find(v => v.id_vol == volId);
          if (!vol) return;

          document.getElementById('modal-origine').textContent = `Origine : ${vol.origine}`;
          document.getElementById('modal-destination').textContent = `Destination : ${vol.destination}`;
          document.getElementById('modal-depart').textContent = `Départ : ${new Date(vol.date_depart).toLocaleString()}`;
          document.getElementById('modal-arrivee').textContent = `Arrivée : ${new Date(vol.date_arrivee).toLocaleString()}`;
          document.getElementById('modal-duree').textContent = `Durée : ${vol.duree}`;
          document.getElementById('modal-prix').textContent = `Prix : ${vol.prix} €`;
          document.getElementById('modal-compagnie').textContent = `Compagnie : ${vol.compagnie || 'Zenith Airlines'}`;
          document.getElementById('modal-passagers').textContent = `Nombre de passagers : ${vol.nb_passagers || 'Non spécifié'}`;

          modal.classList.remove('hidden');
          modal.classList.add('show');
        });
      });

      closeBtn.onclick = () => {
        modal.classList.add('hidden');
        modal.classList.remove('show');
      };

      window.onclick = function (event) {
        if (event.target === modal) {
          modal.classList.add('hidden');
          modal.classList.remove('show');
        }
      };
    }
  </script>
</head>
<body>
  <header>
    <div class="logo">
      <img src="zenith.webp" alt="Logo Zenith Airlines">
    </div>
    <nav>
      <a href="index.html">Accueil</a>
      <a href="vols.html">Vols à venir</a>
      <a href="reserver.html">Réserver un siège</a>
      <a href="contact.html">Nous contacter</a>
    </nav>
  </header>
  <main>
    <section>
      <h2>Vols à venir</h2>
      <p>Découvrez nos prochaines destinations :</p>
      <div class="offers"></div>
    </section>
  </main>
  <footer>
    <p>&copy; 2025 Zenith Airlines. Tous droits réservés.</p>
  </footer>

  <!-- MODALE DÉTAILS VOL -->
  <div id="modal" class="modal hidden">
    <div class="modal-content">
      <span class="close">&times;</span>
      <h2>Détails du vol</h2>
      <p id="modal-origine"></p>
      <p id="modal-destination"></p>
      <p id="modal-depart"></p>
      <p id="modal-arrivee"></p>
      <p id="modal-duree"></p>
      <p id="modal-prix"></p>
      <p id="modal-compagnie"></p>
      <p id="modal-passagers"></p>
    </div>
  </div>
</body>
</html>
