<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Vols à venir - Zenith Airlines</title>
    <link rel="stylesheet" href="styles.css">
    <script>
  let volsData = [];

  document.addEventListener('DOMContentLoaded', function () {
    const offersContainer = document.querySelector('.offers');
    offersContainer.innerHTML = '<p>Chargement des vols...</p>';

    fetch('get_vols.php')
      .then(response => {
        if (!response.ok) {
          throw new Error('Erreur lors de la récupération des données.');
        }
        return response.json();
      })
      .then(data => {
        volsData = data;
        offersContainer.innerHTML = '';

        if (data.length > 0) {
          data.forEach(vol => {
            const volDiv = document.createElement('div');
            volDiv.classList.add('offer');
            volDiv.innerHTML = `
              <div class="offer-details">
                <h3>${vol.origine} - ${vol.destination}</h3>
                <p>Départ : ${new Date(vol.date_depart).toLocaleString()}</p>
                <p>Arrivée : ${new Date(vol.date_arrivee).toLocaleString()}</p>
                <p>Durée : ${vol.duree}</p>
                <p>Prix : ${vol.prix} €</p>
                <div class="buttons">
                  <button class="add-to-cart" data-id="${vol.id_vol}">Ajouter au panier</button>
                  <button class="details-button" data-id="${vol.id_vol}">Détails</button>
                </div>
              </div>
            `;
            offersContainer.appendChild(volDiv);
          });

          attachAddToCartEvents();
          attachDetailsEvents();
        } else {
          offersContainer.innerHTML = '<p>Aucun vol disponible pour le moment.</p>';
        }
      })
      .catch(error => {
        console.error('Erreur :', error);
        offersContainer.innerHTML = '<p>Erreur lors du chargement des vols. Veuillez réessayer plus tard.</p>';
      });
  });

  function attachAddToCartEvents() {
    const addToCartButtons = document.querySelectorAll('.add-to-cart');
    addToCartButtons.forEach(button => {
      button.addEventListener('click', function () {
        const volId = this.dataset.id;

        fetch('add_to_cart.php', {
          method: 'POST',
          headers: { 'Content-Type': 'application/x-www-form-urlencoded' },
          body: `id_vol=${volId}`
        })
          .then(response => response.json())
          .then(data => {
            if (data.success) {
              alert('Vol ajouté au panier avec succès !');
            } else {
              alert(data.error || 'Erreur inconnue.');
            }
          })
          .catch(error => {
            console.error('Erreur réseau :', error);
            alert('Impossible d\'ajouter au panier.');
          });
      });
    });
  }

  function attachDetailsEvents() {
    const detailButtons = document.querySelectorAll('.details-button');
    detailButtons.forEach(button => {
      button.addEventListener('click', function () {
        const volId = this.dataset.id;
        const vol = volsData.find(v => v.id_vol == volId);

        if (!vol) {
          alert("Vol introuvable.");
          return;
        }

        alert(
          `Détails du vol :\n` +
          `Origine : ${vol.origine}\n` +
          `Destination : ${vol.destination}\n` +
          `Départ : ${new Date(vol.date_depart).toLocaleString()}\n` +
          `Arrivée : ${new Date(vol.date_arrivee).toLocaleString()}\n` +
          `Durée : ${vol.duree}\n` +
          `Prix : ${vol.prix} €\n` +
          `Compagnie : ${vol.compagnie || 'Zenith Airlines'}\n` +
          `Nombre de passagers : ${vol.nb_passagers || 'Non spécifié'}`
        );
      });
    });
  }
</script>

</head>
<body>
    <header>
        <div class="logo">
            <img src="zenith.webp" alt="Logo Zenith Airlines">
        </div>
        <nav>
            <a href="index.html">Accueil</a>
            <a href="vols.html">Vols à venir</a>
            <a href="reserver.html">Réserver un siège</a>
            <a href="contact.html">Nous contacter</a>
        </nav>
    </header>
    <main>
        <section>
            <h2>Vols à venir</h2>
            <p>Découvrez nos prochaines destinations :</p>
            <div class="offers">
                <!-- Les vols seront insérés ici dynamiquement -->
            </div>
        </section>
    </main>
    <footer>
        <p>&copy; 2025 Zenith Airlines. Tous droits réservés.</p>
    </footer>
</body>
</html>
